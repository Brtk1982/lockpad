<!-- [S1] Basic HTML structure + styles -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>LockPad</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark light;
        --bg: #020617;
        --card: rgba(15, 23, 42, 0.96);
        --border: rgba(148, 163, 184, 0.35);
        --accent: #22c55e;
        --accent-soft: rgba(34, 197, 94, 0.12);
        --text: #e5e7eb;
        --muted: #9ca3af;
      }

      body.theme-dark {
        --bg: #020617;
        --card: rgba(15, 23, 42, 0.96);
        --border: rgba(148, 163, 184, 0.35);
        --accent: #22c55e;
        --accent-soft: rgba(34, 197, 94, 0.12);
        --text: #e5e7eb;
        --muted: #9ca3af;
      }

      body.theme-light {
        --bg: #f3f4f6;
        --card: rgba(255, 255, 255, 0.98);
        --border: rgba(209, 213, 219, 1);
        --accent: #16a34a;
        --accent-soft: rgba(22, 163, 74, 0.08);
        --text: #111827;
        --muted: #6b7280;
      }

      * {
        box-sizing: border-box;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      /* [S2] Body layout, animation, main shell */
      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #1f2937 0, var(--bg) 55%)
          fixed;
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        transition: background 220ms ease, color 220ms ease;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .shell {
        width: 100%;
        max-width: 880px;
        border-radius: 20px;
        background: var(--card);
        border: 1px solid var(--border);
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.75);
        padding: 18px 20px 20px;
        transition: background 220ms ease, border-color 220ms ease,
          box-shadow 220ms ease, transform 180ms ease;
        animation: fadeInUp 260ms ease-out;
      }

      header {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 16px;
        text-align: center;
      }

      /* [S3] Header: brand, title, meta, LOCAL ONLY pill */
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-dot {
        width: 12px;
        height: 12px;
        border-radius: 999px;
        background: var(--accent);
        box-shadow: 0 0 16px rgba(34, 197, 94, 0.9);
      }

      h1 {
        margin: 0;
        font-size: 1.8rem;
        letter-spacing: 0.1em;
        text-transform: none;
        font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        font-weight: 600;
      }

      .meta {
        font-size: 0.75rem;
        color: var(--muted);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        border: 1px solid var(--border);
        padding: 3px 9px;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--muted);
        background: rgba(15, 23, 42, 0.85);
        transition: background 180ms ease, border-color 180ms ease,
          color 180ms ease, box-shadow 180ms ease;
      }

      body.theme-light .pill {
        background: rgba(243, 244, 246, 0.9);
      }

      .pill-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
      }

      /* [S4] Theme toggle styling + sections grid */
      .theme-toggle {
        border-radius: 999px;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--muted);
        cursor: pointer;
        font-size: 0.78rem;
        padding: 3px 10px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 180ms ease, border-color 180ms ease,
          color 180ms ease, transform 120ms ease, box-shadow 160ms ease;
      }

      .theme-toggle:hover {
        background: var(--accent-soft);
        border-color: var(--accent);
        color: var(--accent);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
      }

      .theme-toggle:active {
        transform: translateY(1px);
        box-shadow: none;
      }

      .sections {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
        gap: 12px;
      }

      .section {
        border-radius: 14px;
        border: 1px solid rgba(51, 65, 85, 0.8);
        background: radial-gradient(circle at top left, #020617, #020617 60%);
        padding: 12px 14px 10px;
        transition: background 200ms ease, border-color 200ms ease,
          box-shadow 200ms ease, transform 160ms ease;
      }

      body.theme-light .section {
        background: radial-gradient(circle at top left, #ffffff, #f9fafb 65%);
        border-color: rgba(209, 213, 219, 1);
      }

      .section:hover {
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.7);
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.9);
      }

      body.theme-light .section:hover {
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.18);
        border-color: rgba(148, 163, 184, 1);
      }

      .section.full {
        grid-column: 1 / -1;
      }

      /* [S5] Section headings, labels, inputs */
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 6px;
      }

      .section-title {
        margin: 0;
        font-size: 0.95rem;
      }

      .section-sub {
        margin: 0;
        font-size: 0.73rem;
        color: var(--muted);
      }

      label {
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--muted);
        margin-top: 8px;
        margin-bottom: 4px;
      }

      input[type="text"],
      input[type="password"] {
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        background: #020617;
        color: var(--text);
        padding: 6px 8px;
        font-size: 0.82rem;
        transition: border-color 180ms ease, box-shadow 180ms ease,
          background-color 180ms ease, color 180ms ease;
      }

      body.theme-light input[type="text"],
      body.theme-light input[type="password"] {
        background: #f9fafb;
        border-color: rgba(209, 213, 219, 1);
      }

      input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
      }

      /* [S6] Textarea, field, hint, buttons, status, responsive */
      textarea {
        width: 100%;
        min-height: 84px;
        border-radius: 10px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        background: #020617;
        color: var(--text);
        padding: 7px 8px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 0.82rem;
        resize: vertical;
        line-height: 1.35;
        transition: border-color 180ms ease, box-shadow 180ms ease,
          background-color 180ms ease, color 180ms ease;
      }

      body.theme-light textarea {
        background: #f9fafb;
        border-color: rgba(209, 213, 219, 1);
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
      }

      .field {
        margin-top: 6px;
      }

      .hint {
        font-size: 0.73rem;
        color: var(--muted);
        margin-top: 3px;
        opacity: 0;
        max-height: 0;
        overflow: hidden;
        transform: translateY(-2px);
        transition:
          opacity 180ms ease,
          max-height 180ms ease,
          transform 180ms ease;
      }

      .field:hover .hint {
        opacity: 1;
        max-height: 80px;
        transform: translateY(0);
      }

      .field input::placeholder,
      .field textarea::placeholder {
        color: transparent;
        transition: color 160ms ease;
      }

      .field:hover input::placeholder,
      .field:hover textarea::placeholder {
        color: var(--muted);
      }

      .button-row {
        margin-top: 9px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      button {
        border-radius: 999px;
        border: 1px solid rgba(75, 85, 99, 1);
        background: #020617;
        color: var(--text);
        cursor: pointer;
        font-size: 0.8rem;
        padding: 6px 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 160ms ease, border-color 160ms ease,
          color 160ms ease, transform 120ms ease, box-shadow 160ms ease;
      }

      body.theme-light button {
        background: #ffffff;
        border-color: rgba(209, 213, 219, 1);
      }

      button.primary {
        border-color: rgba(34, 197, 94, 0.6);
        background: linear-gradient(135deg, #16a34a, #22c55e);
        color: #022c22;
        font-weight: 500;
      }

      body.theme-light button.primary {
        color: #052e16;
      }

      button:hover {
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.6);
        transform: translateY(-1px) scale(1.01);
      }

      body.theme-light button:hover {
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.18);
      }

      button.primary:hover {
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5),
          0 10px 28px rgba(34, 197, 94, 0.4);
      }

      button:active {
        transform: translateY(0);
        box-shadow: none;
      }

      .status {
        margin-top: 10px;
        padding: 6px 9px;
        border-radius: 999px;
        border: 1px solid var(--border);
        font-size: 0.78rem;
        color: var(--muted);
        display: flex;
        align-items: center;
        gap: 6px;
        transition: background 180ms ease, border-color 180ms ease,
          color 180ms ease;
      }

      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
      }

      /* [S6b] Help box styles */
      .help-details {
        margin: 6px 0 0;
      }

      .help-summary {
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(15, 23, 42, 0.85);
        color: var(--muted);
      }

      body.theme-light .help-summary {
        background: rgba(243, 244, 246, 0.95);
      }

      .help-summary::before {
        content: "‚ùì";
        font-size: 0.9rem;
      }

      .help-details[open] .help-summary {
        border-color: var(--accent);
        color: var(--accent);
        background: var(--accent-soft);
      }

      .help-content {
        margin-top: 8px;
        font-size: 0.8rem;
        color: var(--muted);
      }

      .help-content strong {
        color: var(--text);
        font-weight: 500;
      }

      .help-content ol {
        margin: 6px 0 0;
        padding-left: 18px;
      }

      .help-content li {
        margin-bottom: 4px;
      }

      @media (max-width: 760px) {
        body {
          padding: 12px;
        }
        .shell {
          padding: 14px 12px 16px;
        }
        header {
          margin-bottom: 12px;
        }
        .sections {
          grid-template-columns: minmax(0, 1fr);
        }
      }
    </style>
  </head>

  <!-- [S7] Body start + header -->
  <body class="theme-dark">
    <div class="shell">
      <header>
        <div class="brand">
          <div class="logo-dot"></div>
          <h1>Lockpad</h1>
        </div>
        <div class="meta">
          <button id="themeToggle" class="theme-toggle">
            ‚òÄÔ∏è Light mode
          </button>
          <div class="pill">
            <span class="pill-dot"></span>
            <span>LOCAL ONLY</span>
          </div>
          <div>no accounts ¬∑ no logs ¬∑ no server</div>
        </div>
      </header>

      <div class="sections">
        <!-- [S8] Keys section -->
        <section class="section full">
          <div class="section-header">
            <h2 class="section-title">1. Your keys</h2>
          </div>

          <div class="field">
            <label for="keyPassphrase">Key passphrase</label>
            <input
              id="keyPassphrase"
              type="password"
              placeholder="Strong passphrase to protect your private key"
            />
            <div class="hint">
              Important: if you forget this passphrase, you can't decrypt messages
              for this key.
            </div>
          </div>

          <div class="button-row">
            <button id="generateKeys" class="primary">
              Generate keypair
            </button>
          </div>

          <div class="field">
            <label for="publicKey">Your PUBLIC key (share)</label>
            <textarea
              id="publicKey"
              placeholder="Your PUBLIC key will appear here after generation, or you can paste an existing one."
            ></textarea>
            <div class="hint">
              Safe to share. People encrypt messages to you using this.
            </div>
          </div>

          <div class="field">
            <label for="privateKey">Your PRIVATE key (never share)</label>
            <textarea
              id="privateKey"
              placeholder="Your PRIVATE key will appear here after generation, or you can paste an existing one."
            ></textarea>
            <div class="hint">
              Keep this + the passphrase safe. Anyone with both can read your messages.
            </div>
          </div>
        </section>

        <!-- [S9] Encrypt section -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">2. Encrypt</h2>
          </div>

          <div class="field">
            <label for="plainText">Plaintext message</label>
            <textarea
              id="plainText"
              placeholder="Write the text you want to lock."
            ></textarea>
          </div>

          <div class="button-row">
            <button id="encryptButton" class="primary">
              Encrypt
            </button>
          </div>

          <div class="field">
            <label for="cipherText">Encrypted block</label>
            <textarea
              id="cipherText"
              placeholder="PGP MESSAGE block will appear here after encryption."
            ></textarea>
            <div class="hint">
              Copy this into email, WhatsApp, Signal, etc. It's safe to send.
            </div>
          </div>
        </section>

        <!-- [S10] Decrypt section -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">3. Decrypt</h2>
          </div>

          <div class="field">
            <label for="cipherInput">Encrypted block</label>
            <textarea
              id="cipherInput"
              placeholder="Paste the encrypted block you received."
            ></textarea>
            <div class="hint">
              Paste the full encrypted message you received (the whole block).
            </div>
          </div>

          <div class="button-row">
            <button id="decryptButton" class="primary">
              Decrypt
            </button>
          </div>

          <div class="field">
            <label for="plainOutput">Decrypted plaintext</label>
            <textarea
              id="plainOutput"
              placeholder="Your decrypted message will appear here."
            ></textarea>
            <div class="hint">
              This text is only visible in your browser ‚Äì nothing is sent anywhere.
            </div>
          </div>
        </section>
      </div>

      <div class="sections">
      
      </div>

      <!-- [S10b] How to use LockPad -->
      <section class="section full">
        <details class="help-details">
          <summary class="help-summary">
            How to use LockPad (super simple)
          </summary>
          <div class="help-content">
            <p><strong>Think of keys like this:</strong></p>
            <ul>
              <li><strong>Public key</strong> = lock you give to others.</li>
              <li><strong>Private key</strong> = secret key you keep.</li>
              <li><strong>Passphrase</strong> = password that protects your secret key.</li>
            </ul>

            <p><strong>1. Get ready (do this once)</strong></p>
            <ol>
              <li>Type a secret password in <em>Key passphrase</em>.</li>
              <li>Click <em>Generate keypair</em>.</li>
              <li>Save your <strong>PUBLIC key</strong> (you can share this).</li>
              <li>Save your <strong>PRIVATE key</strong> in a safe place (never share this).</li>
              <li>Remember your <strong>passphrase</strong>.</li>
            </ol>

            <p><strong>2. Send a secret message to someone</strong></p>
            <ol>
              <li>Ask them for <strong>their PUBLIC key</strong>.</li>
              <li>Paste their public key into the <em>Your PUBLIC key</em> box.</li>
              <li>Write your message in <em>Plaintext message</em>.</li>
              <li>Click <em>Encrypt</em>.</li>
              <li>Copy the <strong>encrypted block</strong> and send it to them (email, chat, etc.).</li>
            </ol>

            <p><strong>3. Read a secret message from someone</strong></p>
            <ol>
              <li>Make sure your <strong>PRIVATE key</strong> is in the private key box.</li>
              <li>Type your <strong>passphrase</strong> in <em>Key passphrase</em>.</li>
              <li>Paste the <strong>encrypted block</strong> you received into the decrypt box.</li>
              <li>Click <em>Decrypt</em>.</li>
              <li>Read your message in <em>Decrypted plaintext</em>.</li>
            </ol>

            <p><strong>Local only:</strong> all encryption/decryption happens in your browser. No accounts, no server logs.</p>
          </div>
        </details>
      </section>

      <!-- [S11] Status bar -->
      <div class="status" id="statusBar">

      <!-- [S11] Status bar -->
      <div class="status" id="statusBar">
        <div class="status-dot"></div>
        <span>UI+keys+crypto</span>
        <span>
          Ready. Set a passphrase and click ‚ÄúGenerate keypair‚Äù to create a real PGP key.
        </span>
      </div>
    </div>

    <!-- [S12] OpenPGP library from CDN -->
    <script src="https://unpkg.com/openpgp@6.1.1/dist/openpgp.min.js"></script>

    <!-- [S13] Theme toggle, status helper, keygen, REAL encrypt/decrypt -->
    <script>
      "use strict";

      // === **section**: THEME + STATUS ===================================

      const bodyEl = document.body;
      const themeToggleBtn = document.getElementById("themeToggle");
      const statusBar = document.getElementById("statusBar");

      function setStatus(label, text) {
        const spans = statusBar.querySelectorAll("span");
        if (spans[0]) spans[0].textContent = label;
        if (spans[1]) spans[1].textContent = text;
      }

      function setTheme(toLight) {
        if (toLight) {
          bodyEl.classList.remove("theme-dark");
          bodyEl.classList.add("theme-light");
          themeToggleBtn.textContent = "üåô Dark mode";
        } else {
          bodyEl.classList.remove("theme-light");
          bodyEl.classList.add("theme-dark");
          themeToggleBtn.textContent = "‚òÄÔ∏è Light mode";
        }
      }

      themeToggleBtn.addEventListener("click", () => {
        const isDark = bodyEl.classList.contains("theme-dark");
        setTheme(isDark);
      });

      // === **section**: KEY GENERATION ===================================

      const generateBtn = document.getElementById("generateKeys");

      async function generateKeypair() {
        const name = "LockPad user";
        const email = "";
        const passphrase = document
          .getElementById("keyPassphrase")
          .value.trim();

        if (!passphrase) {
          alert("Set a strong passphrase first ‚Äì this protects your private key.");
          return;
        }

        try {
          generateBtn.disabled = true;
          setStatus("Generating", "Creating a new PGP keypair...");

          const { privateKey, publicKey } = await openpgp.generateKey({
            type: "rsa",
            rsaBits: 4096,
            userIDs: [{ name, email }],
            passphrase
          });

          document.getElementById("publicKey").value = publicKey;
          document.getElementById("privateKey").value = privateKey;

          setStatus(
            "Keys ready",
            "Keypair generated. Save your private key and remember your passphrase."
          );
        } catch (err) {
          console.error(err);
          alert(
            "Key generation failed: " +
              err.message +
              "\n\nIf this keeps happening, we might need to run LockPad via http://localhost instead of double-clicking the file. I can help you with that."
          );
          setStatus("Error", "Key generation failed. Check console for details.");
        } finally {
          generateBtn.disabled = false;
        }
      }

      generateBtn.addEventListener("click", () => {
        generateKeypair();
      });

      // === **section**: ENCRYPTION (REAL PGP) ============================

      async function encryptMessage() {
        const publicKeyArmored = document
          .getElementById("publicKey")
          .value.trim();
        const messageText = document.getElementById("plainText").value;

        if (!publicKeyArmored) {
          alert("Public key is empty. Generate or paste a PUBLIC key first.");
          return;
        }

        if (!messageText) {
          alert("Nothing to encrypt ‚Äì plaintext is empty.");
          return;
        }

        try {
          setStatus("Encrypting", "Encrypting message with the public key...");
          const message = await openpgp.createMessage({ text: messageText });

          const encryptionKey = await openpgp.readKey({
            armoredKey: publicKeyArmored
          });

          const encrypted = await openpgp.encrypt({
            message,
            encryptionKeys: encryptionKey
          });

          document.getElementById("cipherText").value = encrypted;
          setStatus(
            "Encrypted",
            "Done. Copy the encrypted block and send it via any channel."
          );
        } catch (err) {
          console.error(err);
          alert(
            "Encryption failed: " +
              err.message +
              "\n\nCheck that the PUBLIC key is valid."
          );
          setStatus("Error", "Encryption failed. Check console for details.");
        }
      }

      // === **section**: DECRYPTION (REAL PGP) ============================

      async function decryptMessage() {
        const privateKeyArmored = document
          .getElementById("privateKey")
          .value.trim();
        const passphrase = document
          .getElementById("keyPassphrase")
          .value.trim();
        const armoredMessage = document
          .getElementById("cipherInput")
          .value.trim();

        if (!privateKeyArmored) {
          alert("Private key is empty. Paste your PRIVATE key first.");
          return;
        }

        if (!armoredMessage) {
          alert("Nothing to decrypt ‚Äì encrypted block is empty.");
          return;
        }

        if (!passphrase) {
          alert("Enter the passphrase you used when generating this key.");
          return;
        }

        try {
          setStatus("Decrypting", "Trying to decrypt with your private key...");

          const privateKeyObj = await openpgp.readPrivateKey({
            armoredKey: privateKeyArmored
          });

          const decryptionKey = await openpgp.decryptKey({
            privateKey: privateKeyObj,
            passphrase
          });

          const message = await openpgp.readMessage({
            armoredMessage
          });

          const { data: decryptedText } = await openpgp.decrypt({
            message,
            decryptionKeys: decryptionKey
          });

          document.getElementById("plainOutput").value = decryptedText;
          setStatus(
            "Decrypted",
            "Success. If the output looks right, your key and passphrase match."
          );
        } catch (err) {
          console.error(err);
          alert(
            "Decryption failed: " +
              err.message +
              "\n\nCheck the PRIVATE key, passphrase, and encrypted block."
          );
          setStatus("Error", "Decryption failed. Check console for details.");
        }
      }

      // === **section**: EVENT WIRING (ENCRYPT/DECRYPT) ===================

      document
        .getElementById("encryptButton")
        .addEventListener("click", () => {
          encryptMessage();
        });

      document
        .getElementById("decryptButton")
        .addEventListener("click", () => {
          decryptMessage();
        });

      // === **section**: FUTURE UTILITIES ================================
      // (Copy buttons, clear buttons, etc. can go here later.)
    </script>
  </body>
</html>
